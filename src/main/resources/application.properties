# Configuration corrig\u00E9e pour collectFocep

spring.application.name=collectFocep
spring.datasource.url=jdbc:mysql://localhost:3306/collect_focep_bd?useSSL=false&serverTimezone=UTC&characterEncoding=UTF-8&createDatabaseIfNotExist=true&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=dido0605

# JPA / Hibernate - Configuration CRITIQUE
# CHANGEMENT: Utilisez CREATE pour la premi\u00E8re fois avec le profile init, puis VALIDATE
spring.jpa.hibernate.ddl-auto=create
# IMPORTANT: Utilisation de la strat\u00E9gie PhysicalNamingStrategyStandardImpl
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.hibernate.naming.implicit-strategy=org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy

# Configuration Hibernate pour debugging
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
# CORRECTION: lazy loading \u00E0 true pour \u00E9viter les probl\u00E8mes d'initialisation
spring.jpa.open-in-view=true

# Am\u00E9lioration des performances
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# AJOUT: Generation de schema pour debug
spring.jpa.properties.hibernate.hbm2ddl.auto=create
spring.jpa.defer-datasource-initialization=true

# Configuration Jackson
spring.jackson.serialization.FAIL_ON_EMPTY_BEANS=false
spring.jackson.time-zone=UTC
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.serialization.write-dates-as-timestamps=false
# AJOUT: Gestion des lazy loading et Hibernate
spring.jackson.serialization.fail-on-empty-beans=false

# Logging optimis\u00E9 pour debugging
logging.level.org.springframework.security=INFO
logging.level.org.example.collectfocep=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.hibernate.engine.jdbc.spi.SqlExceptionHelper=DEBUG
# AJOUT: Logging pour les services d'initialisation
logging.level.org.example.collectfocep.services.impl.SystemAccountService=DEBUG
logging.level.org.example.collectfocep.config.DatabaseInitializationRunner=DEBUG

# JWT Configuration
jwt.secret=4LTVxS2ny0UJfmNVbSjaNC0S/qKbK/yaqXPOms+V2IWiH8qzVHu4ZDFXhlf8NWaYk2C1I9Cv3CEyh17bXvfdSg==
jwt.expiration=3600000

# Audit configuration
audit.enabled=true

# Cache Configuration
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=1000,expireAfterAccess=3600s

# Encodage
spring.mandatory-file-encoding=UTF-8
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# Configuration des param\u00E8tres m\u00E9tier
transaction.timeout=30
commission.tva.rate=0.1925
commission.emf.rate=0.30
commission.nouveauCollecteur.duree=3
commission.nouveau.collecteur=40000
commission.calculation.on.movement=false

# Profile d'initialisation - CRITIQUE
spring.profiles.active=init

# SUPPRESSION: Conflits potentiels
# spring.main.lazy-initialization=true  # Peut causer des probl\u00E8mes avec l'init
# debug=true  # Trop verbeux pour la production

# Configuration des connexions DB
spring.datasource.hikari.connection-timeout=60000
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000

# Configuration serveur
server.address=0.0.0.0
server.port=8080

# AJOUT: Configuration pour \u00E9viter les timeouts
spring.transaction.default-timeout=30
server.tomcat.connection-timeout=20000
server.tomcat.threads.max=200
server.tomcat.accept-count=100

# AJOUT: Configuration pour les logs d'erreur
logging.level.org.example.collectfocep.entities=DEBUG
logging.level.org.hibernate.persister.entity=DEBUG